!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("crypto"),require("buffer")):"function"==typeof define&&define.amd?define("keycloak",["crypto","buffer"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).Keycloak=t(e.require$$0,e.require$$1)}(this,function(e,t){"use strict";var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(e){throw Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}function o(e){try{let t=new URL(e,window.location.origin);if(t.origin===window.location.origin)return t.pathname+t.search}catch(r){}return"/"}var i,s,a,c={exports:{}};i=c,a=function(){function e(e){return"function"==typeof e}function t(e){S=e}function n(e){A=e}function o(){var e=setTimeout;return function(){return e(i,1)}}function i(){for(var e,t=0;t<w;t+=2){(0,O[t])(O[t+1]),O[t]=void 0,O[t+1]=void 0}w=0}function s(e,t){var r=this,n=new this.constructor(c);void 0===n[P]&&g(n);var o=r._state;if(o){var i=arguments[o-1];A(function(){return v(o,n,i,r._result)})}else d(r,n,e,t);return n}function a(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(c);return l(t,e),t}function c(){}function u(t,r,n){var o,i,c,u,f;r.constructor===t.constructor&&n===s&&r.constructor.resolve===a?(o=t,(i=r)._state===M?h(o,i._result):i._state===j?$(o,i._result):d(i,void 0,function(e){return l(o,e)},function(e){return $(o,e)})):void 0===n?h(t,r):e(n)?(c=t,u=r,f=n,A(function(e){var t=!1,r=function e(t,r,n,o){try{t.call(r,n,o)}catch(i){return i}}(f,u,function(r){t||(t=!0,u!==r?l(e,r):h(e,r))},function(r){t||(t=!0,$(e,r))},"Settle: "+(e._label||" unknown promise"));!t&&r&&(t=!0,$(e,r))},c)):h(t,r)}function l(e,t){if(e===t)$(e,TypeError("You cannot resolve a promise with itself"));else if(n=typeof(r=t),null!==r&&("object"===n||"function"===n)){var r,n,o=void 0;try{o=t.then}catch(i){return void $(e,i)}u(e,t,o)}else h(e,t)}function f(e){e._onerror&&e._onerror(e._result),p(e)}function h(e,t){e._state===R&&(e._result=t,e._state=M,0!==e._subscribers.length&&A(p,e))}function $(e,t){e._state===R&&(e._state=j,e._result=t,A(f,e))}function d(e,t,r,n){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+M]=r,o[i+j]=n,0===i&&e._state&&A(p,e)}function p(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,o=void 0,i=e._result,s=0;s<t.length;s+=3)n=t[s],o=t[s+r],n?v(r,n,o,i):o(i);e._subscribers.length=0}}function v(t,r,n,o){var i=e(n),s=void 0,a=void 0,c=!0;if(i){try{s=n(o)}catch(u){c=!1,a=u}if(r===s)return void $(r,TypeError("A promises callback cannot return that same promise."))}else s=o;r._state!==R||(i&&c?l(r,s):!1===c?$(r,a):t===M?h(r,s):t===j&&$(r,s))}function g(e){e[P]=V++,e._state=void 0,e._result=void 0,e._subscribers=[]}var x,m,k,_,b=void 0,y=b=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},w=0,F=void 0,S=void 0,A=function(e,t){O[w]=e,O[w+1]=t,2===(w+=2)&&(S?S(i):L())},T="undefined"!=typeof window?window:void 0,U=T||{},E=U.MutationObserver||U.WebKitMutationObserver,I="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"===({}).toString.call(process),C="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,O=Array(1e3),L=void 0;L=I?function(){return process.nextTick(i)}:E?(x=0,m=new E(i),k=document.createTextNode(""),m.observe(k,{characterData:!0}),function(){k.data=x=++x%2}):C?((_=new MessageChannel).port1.onmessage=i,function(){return _.port2.postMessage(0)}):void 0===T?function e(){try{var t=Function("return this")().require("vertx");return F=t.runOnLoop||t.runOnContext,void 0!==F?function(){F(i)}:o()}catch(r){return o()}}():o();var P=Math.random().toString(36).substring(2),R=void 0,M=1,j=2,V=0,H=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(c),this.promise[P]||g(this.promise),y(t)?(this.length=t.length,this._remaining=t.length,this._result=Array(this.length),0===this.length?h(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&h(this.promise,this._result))):$(this.promise,Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===R&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===a){var o=void 0,i=void 0,l=!1;try{o=e.then}catch(f){l=!0,i=f}if(o===s&&e._state!==R)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(r===K){var h=new r(c);l?$(h,i):u(h,e,o),this._willSettleAt(h,t)}else this._willSettleAt(new r(function(t){return t(e)}),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===R&&(this._remaining--,e===j?$(n,r):this._result[t]=r),0===this._remaining&&h(n,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;d(e,void 0,function(e){return r._settledAt(M,t,e)},function(e){return r._settledAt(j,t,e)})},e}(),K=function(){function t(e){this[P]=V++,this._result=this._state=void 0,this._subscribers=[],c!==e&&("function"!=typeof e&&function e(){throw TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function e(t,r){try{r(function(e){l(t,e)},function(e){$(t,e)})}catch(n){$(t,n)}}(this,e):function e(){throw TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var r=this.constructor;return e(t)?this.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){throw e})}):this.then(t,t)},t}();return K.prototype.then=s,K.all=function e(t){return new H(this,t).promise},K.race=function e(t){var r=this;return new r(y(t)?function(e,n){for(var o=t.length,i=0;i<o;i++)r.resolve(t[i]).then(e,n)}:function(e,t){return t(TypeError("You must pass an array to race."))})},K.resolve=a,K.reject=function e(t){var r=new this(c);return $(r,t),r},K._setScheduler=t,K._setAsap=n,K._asap=A,K.polyfill=function e(){var t=void 0;if(void 0!==r)t=r;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(n){throw Error("polyfill failed because global object is unavailable in this environment")}var o=t.Promise;if(o){var i=null;try{i=Object.prototype.toString.call(o.resolve())}catch(s){}if("[object Promise]"===i&&!o.cast)return}t.Promise=K},K.Promise=K,K},i.exports=a();var u,l,f=c.exports,h={exports:{}};u=h,function(){var n="input is invalid type",o="object"==typeof window,i=o?window:{};i.JS_SHA256_NO_WINDOW&&(o=!1);var s=!o&&"object"==typeof self,a=!i.JS_SHA256_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;a?i=r:s&&(i=self);var c=!i.JS_SHA256_NO_COMMON_JS&&u.exports,l=!i.JS_SHA256_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,f="0123456789abcdef".split(""),h=[-2147483648,8388608,32768,128],$=[24,16,8,0],d=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],p=["hex","array","digest","arrayBuffer"],v=[];(i.JS_SHA256_NO_NODE_JS||!Array.isArray)&&(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),l&&(i.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});var g=function(e,t){return function(r){return new b(t,!0).update(r)[e]()}},x=function(e){var t=g("hex",e);a&&(t=m(t,e)),t.create=function(){return new b(e)},t.update=function(e){return t.create().update(e)};for(var r=0;r<p.length;++r){var n=p[r];t[n]=g(n,e)}return t},m=function(r,o){var s,a=e,c=t.Buffer,u=o?"sha224":"sha256";return s=c.from&&!i.JS_SHA256_NO_BUFFER_FROM?c.from:function(e){return new c(e)},function(e){if("string"==typeof e)return a.createHash(u).update(e,"utf8").digest("hex");if(null==e)throw Error(n);return e.constructor===ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||ArrayBuffer.isView(e)||e.constructor===c?a.createHash(u).update(s(e)).digest("hex"):r(e)}},k=function(e,t){return function(r,n){return new y(r,t,!0).update(n)[e]()}},_=function(e){var t=k("hex",e);t.create=function(t){return new y(t,e)},t.update=function(e,r){return t.create(e).update(r)};for(var r=0;r<p.length;++r){var n=p[r];t[n]=k(n,e)}return t};function b(e,t){t?(v[0]=v[16]=v[1]=v[2]=v[3]=v[4]=v[5]=v[6]=v[7]=v[8]=v[9]=v[10]=v[11]=v[12]=v[13]=v[14]=v[15]=0,this.blocks=v):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}function y(e,t,r){var o,i=typeof e;if("string"===i){var s,a=[],c=e.length,u=0;for(o=0;o<c;++o)(s=e.charCodeAt(o))<128?a[u++]=s:s<2048?(a[u++]=192|s>>>6,a[u++]=128|63&s):s<55296||s>=57344?(a[u++]=224|s>>>12,a[u++]=128|s>>>6&63,a[u++]=128|63&s):(s=65536+((1023&s)<<10|1023&e.charCodeAt(++o)),a[u++]=240|s>>>18,a[u++]=128|s>>>12&63,a[u++]=128|s>>>6&63,a[u++]=128|63&s);e=a}else if("object"===i){if(null===e)throw Error(n);if(l&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!Array.isArray(e)&&(!l||!ArrayBuffer.isView(e)))throw Error(n)}else throw Error(n);e.length>64&&(e=new b(t,!0).update(e).array());var f=[],h=[];for(o=0;o<64;++o){var $=e[o]||0;f[o]=92^$,h[o]=54^$}b.call(this,t,r),this.update(h),this.oKeyPad=f,this.inner=!0,this.sharedMemory=r}b.prototype.update=function(e){if(!this.finalized){var t,r=typeof e;if("string"!==r){if("object"===r){if(null===e)throw Error(n);if(l&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!Array.isArray(e)&&(!l||!ArrayBuffer.isView(e)))throw Error(n)}else throw Error(n);t=!0}for(var o,i,s=0,a=e.length,c=this.blocks;s<a;){if(this.hashed&&(this.hashed=!1,c[0]=this.block,this.block=c[16]=c[1]=c[2]=c[3]=c[4]=c[5]=c[6]=c[7]=c[8]=c[9]=c[10]=c[11]=c[12]=c[13]=c[14]=c[15]=0),t)for(i=this.start;s<a&&i<64;++s)c[i>>>2]|=e[s]<<$[3&i++];else for(i=this.start;s<a&&i<64;++s)(o=e.charCodeAt(s))<128?c[i>>>2]|=o<<$[3&i++]:o<2048?(c[i>>>2]|=(192|o>>>6)<<$[3&i++],c[i>>>2]|=(128|63&o)<<$[3&i++]):o<55296||o>=57344?(c[i>>>2]|=(224|o>>>12)<<$[3&i++],c[i>>>2]|=(128|o>>>6&63)<<$[3&i++],c[i>>>2]|=(128|63&o)<<$[3&i++]):(o=65536+((1023&o)<<10|1023&e.charCodeAt(++s)),c[i>>>2]|=(240|o>>>18)<<$[3&i++],c[i>>>2]|=(128|o>>>12&63)<<$[3&i++],c[i>>>2]|=(128|o>>>6&63)<<$[3&i++],c[i>>>2]|=(128|63&o)<<$[3&i++]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.block=c[16],this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},b.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>>2]|=h[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},b.prototype.hash=function(){var e,t,r,n,o,i,s,a,c,u,l,f=this.h0,h=this.h1,$=this.h2,p=this.h3,v=this.h4,g=this.h5,x=this.h6,m=this.h7,k=this.blocks;for(e=16;e<64;++e)t=((o=k[e-15])>>>7|o<<25)^(o>>>18|o<<14)^o>>>3,r=((o=k[e-2])>>>17|o<<15)^(o>>>19|o<<13)^o>>>10,k[e]=k[e-16]+t+k[e-7]+r<<0;for(e=0,l=h&$;e<64;e+=4)this.first?(this.is224?(a=300032,m=(o=k[0]-1413257819)-150054599<<0,p=o+24177077<<0):(a=704751109,m=(o=k[0]-210244248)-1521486534<<0,p=o+143694565<<0),this.first=!1):(t=(f>>>2|f<<30)^(f>>>13|f<<19)^(f>>>22|f<<10),r=(v>>>6|v<<26)^(v>>>11|v<<21)^(v>>>25|v<<7),n=(a=f&h)^f&$^l,o=m+r+(s=v&g^~v&x)+d[e]+k[e],i=t+n,m=p+o<<0,p=o+i<<0),t=(p>>>2|p<<30)^(p>>>13|p<<19)^(p>>>22|p<<10),r=(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7),n=(c=p&f)^p&h^a,o=x+r+(s=m&v^~m&g)+d[e+1]+k[e+1],i=t+n,x=$+o<<0,t=(($=o+i<<0)>>>2|$<<30)^($>>>13|$<<19)^($>>>22|$<<10),r=(x>>>6|x<<26)^(x>>>11|x<<21)^(x>>>25|x<<7),n=(u=$&p)^$&f^c,o=g+r+(s=x&m^~x&v)+d[e+2]+k[e+2],i=t+n,g=h+o<<0,t=((h=o+i<<0)>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10),r=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7),n=(l=h&$)^h&p^u,o=v+r+(s=g&x^~g&m)+d[e+3]+k[e+3],i=t+n,v=f+o<<0,f=o+i<<0,this.chromeBugWorkAround=!0;this.h0=this.h0+f<<0,this.h1=this.h1+h<<0,this.h2=this.h2+$<<0,this.h3=this.h3+p<<0,this.h4=this.h4+v<<0,this.h5=this.h5+g<<0,this.h6=this.h6+x<<0,this.h7=this.h7+m<<0},b.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3,o=this.h4,i=this.h5,s=this.h6,a=this.h7,c=f[e>>>28&15]+f[e>>>24&15]+f[e>>>20&15]+f[e>>>16&15]+f[e>>>12&15]+f[e>>>8&15]+f[e>>>4&15]+f[15&e]+f[t>>>28&15]+f[t>>>24&15]+f[t>>>20&15]+f[t>>>16&15]+f[t>>>12&15]+f[t>>>8&15]+f[t>>>4&15]+f[15&t]+f[r>>>28&15]+f[r>>>24&15]+f[r>>>20&15]+f[r>>>16&15]+f[r>>>12&15]+f[r>>>8&15]+f[r>>>4&15]+f[15&r]+f[n>>>28&15]+f[n>>>24&15]+f[n>>>20&15]+f[n>>>16&15]+f[n>>>12&15]+f[n>>>8&15]+f[n>>>4&15]+f[15&n]+f[o>>>28&15]+f[o>>>24&15]+f[o>>>20&15]+f[o>>>16&15]+f[o>>>12&15]+f[o>>>8&15]+f[o>>>4&15]+f[15&o]+f[i>>>28&15]+f[i>>>24&15]+f[i>>>20&15]+f[i>>>16&15]+f[i>>>12&15]+f[i>>>8&15]+f[i>>>4&15]+f[15&i]+f[s>>>28&15]+f[s>>>24&15]+f[s>>>20&15]+f[s>>>16&15]+f[s>>>12&15]+f[s>>>8&15]+f[s>>>4&15]+f[15&s];return this.is224||(c+=f[a>>>28&15]+f[a>>>24&15]+f[a>>>20&15]+f[a>>>16&15]+f[a>>>12&15]+f[a>>>8&15]+f[a>>>4&15]+f[15&a]),c},b.prototype.toString=b.prototype.hex,b.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3,o=this.h4,i=this.h5,s=this.h6,a=this.h7,c=[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t,r>>>24&255,r>>>16&255,r>>>8&255,255&r,n>>>24&255,n>>>16&255,n>>>8&255,255&n,o>>>24&255,o>>>16&255,o>>>8&255,255&o,i>>>24&255,i>>>16&255,i>>>8&255,255&i,s>>>24&255,s>>>16&255,s>>>8&255,255&s];return this.is224||c.push(a>>>24&255,a>>>16&255,a>>>8&255,255&a),c},b.prototype.array=b.prototype.digest,b.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),t.setUint32(20,this.h5),t.setUint32(24,this.h6),this.is224||t.setUint32(28,this.h7),e},y.prototype=new b,y.prototype.finalize=function(){if(b.prototype.finalize.call(this),this.inner){this.inner=!1;var e=this.array();b.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(e),b.prototype.finalize.call(this)}};var w=x();w.sha256=w,w.sha224=x(!0),w.sha256.hmac=_(),w.sha224.hmac=_(!0),c?u.exports=w:(i.sha256=w.sha256,i.sha224=w.sha224)}();var $=(l=h.exports)&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l;class d extends Error{}function p(e,t){if("string"!=typeof e)throw new d("Invalid token specified: must be a string");t||(t={});let r=!0===t.header?0:1,n=e.split(".")[r];if("string"!=typeof n)throw new d(`Invalid token specified: missing part #${r+1}`);let o;try{o=function e(t){let r=t.replace(/-/g,"+").replace(/_/g,"/");switch(r.length%4){case 0:break;case 2:r+="==";break;case 3:r+="=";break;default:throw Error("base64 string is not of the correct length")}try{var n;return n=r,decodeURIComponent(atob(n).replace(/(.)/g,(e,t)=>{let r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}catch(o){return atob(r)}}(n)}catch(i){throw new d(`Invalid token specified: invalid base64 for part #${r+1} (${i.message})`)}try{return JSON.parse(o)}catch(s){throw new d(`Invalid token specified: invalid json for part #${r+1} (${s.message})`)}}if(d.prototype.name="InvalidTokenError",void 0===f.Promise)throw Error("Keycloak requires an environment that supports Promises. Make sure that you include the appropriate polyfill.");return function e(t){if(!(this instanceof e))throw Error("The 'Keycloak' constructor must be invoked with 'new'.");for(var r,n,o=this,i=[],s={enable:!0,callbackList:[],interval:5},a=document.getElementsByTagName("script"),c=0;c<a.length;c++)(-1!==a[c].src.indexOf("keycloak.js")||-1!==a[c].src.indexOf("keycloak.min.js"))&&-1!==a[c].src.indexOf("version=")&&(o.iframeVersion=a[c].src.substring(a[c].src.indexOf("version=")+8).split("&")[0]);var u=!0,l=C(console.info),h=C(console.warn);function d(e,t){for(var r=function e(t){var r=null,n=window.crypto||window.msCrypto;if(n&&n.getRandomValues&&window.Uint8Array)return r=new Uint8Array(t),n.getRandomValues(r),r;r=Array(t);for(var o=0;o<r.length;o++)r[o]=Math.floor(256*Math.random());return r}(e),n=Array(e),o=0;o<e;o++)n[o]=t.charCodeAt(r[o]%t.length);return String.fromCharCode.apply(null,n)}function v(){return void 0===o.authServerUrl?void 0:"/"==o.authServerUrl.charAt(o.authServerUrl.length-1)?o.authServerUrl+"realms/"+encodeURIComponent(o.realm):o.authServerUrl+"/realms/"+encodeURIComponent(o.realm)}function g(e,t){var r=e.code,n=e.error,i=e.prompt,s=new Date().getTime();if(e.kc_action_status&&o.onActionUpdate&&o.onActionUpdate(e.kc_action_status),n){if("none"!=i){var a={error:n,error_description:e.error_description};o.onAuthError&&o.onAuthError(a),t&&t.setError(a)}else t&&t.setSuccess();return}if("standard"!=o.flow&&(e.access_token||e.id_token)&&$(e.access_token,null,e.id_token,!0),"implicit"!=o.flow&&r){var c="code="+r+"&grant_type=authorization_code",f=o.endpoints.token(),h=new XMLHttpRequest;h.open("POST",f,!0),h.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c+="&client_id="+encodeURIComponent(o.clientId),c+="&redirect_uri="+e.redirectUri,e.pkceCodeVerifier&&(c+="&code_verifier="+e.pkceCodeVerifier),h.withCredentials=!0,h.onreadystatechange=function(){if(4==h.readyState){if(200==h.status){var e=JSON.parse(h.responseText);$(e.access_token,e.refresh_token,e.id_token,"standard"===o.flow),S()}else o.onAuthError&&o.onAuthError(),t&&t.setError()}},h.send(c)}function $(r,n,i,a){s=(s+new Date().getTime())/2,m(r,n,i,s),u&&o.idTokenParsed&&o.idTokenParsed.nonce!=e.storedNonce?(l("[KEYCLOAK] Invalid nonce, clearing token"),o.clearToken(),t&&t.setError()):a&&(o.onAuthSuccess&&o.onAuthSuccess(),t&&t.setSuccess())}}function x(e){return 0==e.status&&e.responseText&&e.responseURL.startsWith("file:")}function m(e,t,r,n){if(o.tokenTimeoutHandle&&(clearTimeout(o.tokenTimeoutHandle),o.tokenTimeoutHandle=null),t?(o.refreshToken=t,o.refreshTokenParsed=p(t)):(delete o.refreshToken,delete o.refreshTokenParsed),r?(o.idToken=r,o.idTokenParsed=p(r)):(delete o.idToken,delete o.idTokenParsed),e){if(o.token=e,o.tokenParsed=p(e),o.sessionId=o.tokenParsed.session_state,o.authenticated=!0,o.subject=o.tokenParsed.sub,o.realmAccess=o.tokenParsed.realm_access,o.resourceAccess=o.tokenParsed.resource_access,n&&(o.timeSkew=Math.floor(n/1e3)-o.tokenParsed.iat),null!=o.timeSkew&&(l("[KEYCLOAK] Estimated time difference between browser and server is "+o.timeSkew+" seconds"),o.onTokenExpired)){var i=(o.tokenParsed.exp-new Date().getTime()/1e3+o.timeSkew)*1e3;l("[KEYCLOAK] Token expires in "+Math.round(i/1e3)+" s"),i<=0?o.onTokenExpired():o.tokenTimeoutHandle=setTimeout(o.onTokenExpired,i)}}else delete o.token,delete o.tokenParsed,delete o.subject,delete o.realmAccess,delete o.resourceAccess,o.authenticated=!1}function k(){var e="0123456789abcdef",t=d(36,e).split("");return t[14]="4",t[19]=e.substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")}function _(e){var t=function e(t){switch(o.flow){case"standard":r=["code","state","session_state","kc_action_status","iss"];break;case"implicit":r=["access_token","token_type","id_token","state","session_state","expires_in","kc_action_status","iss"];break;case"hybrid":r=["access_token","token_type","id_token","code","state","session_state","expires_in","kc_action_status","iss"];break;default:return console.warn("Unknown flow:",o.flow),null}r.push("error","error_description","error_uri");var r,n,i=t.indexOf("?"),s=t.indexOf("#"),a=t;if("query"===o.responseMode&&-1!==i)a=t.substring(0,i),""!==(n=b(t.substring(i+1,-1!==s?s:t.length),r)).paramsString&&(a+="?"+n.paramsString),-1!==s&&(a+=t.substring(s));else{if("fragment"!==o.responseMode||-1===s)return null;a=t.substring(0,s),""!==(n=b(t.substring(s+1),r)).paramsString&&(a+="#"+n.paramsString)}if(n&&n.oauthParams){if("standard"===o.flow||"hybrid"===o.flow){if((n.oauthParams.code||n.oauthParams.error)&&n.oauthParams.state)return n.oauthParams.newUrl=a,n.oauthParams}else if("implicit"===o.flow&&(n.oauthParams.access_token||n.oauthParams.error)&&n.oauthParams.state)return n.oauthParams.newUrl=a,n.oauthParams}return null}(e);if(!t)return console.warn("parseCallbackUrl returned falsy for url:",e),null;if(!t.state||"string"!=typeof t.state||t.state.length>256)return console.warn("Invalid or missing oauth.state:",t.state),null;var r=n.get(t.state);return r?(t.valid=!0,t.redirectUri=r.redirectUri,t.storedNonce=r.nonce,t.prompt=r.prompt,t.pkceCodeVerifier=r.pkceCodeVerifier,t):(console.warn("No matching state in callbackStorage for:",t.state),null)}function b(e,t){if("string"!=typeof e||e.length>1e4)return console.error("Invalid or overly long callback parameters at parseCallbackParams"),{paramsString:"",oauthParams:{}};let r=e.split("&"),n=r.slice(0,200),o={paramsString:"",oauthParams:{}};for(let i=0;i<n.length;i++){let s=n[i];if("string"!=typeof s||0===s.length)continue;let a=s.indexOf("=");if(-1===a)continue;let c,u;try{c=decodeURIComponent(s.slice(0,a)).trim(),u=decodeURIComponent(s.slice(a+1)).trim()}catch(l){console.warn("Failed to decode param:",s);continue}c&&(t.includes(c)?o.oauthParams[c]=u:(""!==o.paramsString&&(o.paramsString+="&"),o.paramsString+=encodeURIComponent(c)+"="+encodeURIComponent(u)))}return o}function y(){var e={setSuccess:function(t){e.resolve(t)},setError:function(t){e.reject(t)}};return e.promise=new f.Promise(function(t,r){e.resolve=t,e.reject=r}),e}function w(){let e=F();var t=y();if(!s.enable||s.iframe)return t.setSuccess(),t.promise;var r=document.createElement("iframe");s.iframe=r,r.onload=function(){var e=o.endpoints.authorize();"/"===e.charAt(0)?s.iframeOrigin=window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""):s.iframeOrigin=e.substring(0,e.indexOf("/",8)),t.setSuccess()};var n=o.endpoints.checkSessionIframe();r.setAttribute("src",n),r.setAttribute("sandbox",e),r.setAttribute("title","keycloak-session-iframe"),r.style.display="none",document.body.appendChild(r);var i=function(e){if(e.origin===s.iframeOrigin&&s.iframe.contentWindow===e.source&&("unchanged"==e.data||"changed"==e.data||"error"==e.data)){"unchanged"!=e.data&&o.clearToken();for(var t=s.callbackList.splice(0,s.callbackList.length),r=t.length-1;r>=0;--r){var n=t[r];"error"==e.data?n.setError():n.setSuccess("unchanged"==e.data)}}};return window.addEventListener("message",i,!1),t.promise}function F(){return function e(t,r=3){let n=atob(t),o="";for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);o+=String.fromCharCode(s-r+256&255)}return o}("aXR0d381e3x3emlvbTVpa2tte3s1aoE1fXttejVpa3xxfml8cXd2KGl0dHd/NXtrenF4fHsoaXR0d381e2l1bTV3enFvcXY=",8)}function S(){s.enable&&o.token&&setTimeout(function(){A().then(function(e){e&&S()})},1e3*s.interval)}function A(){var e=y();if(s.iframe&&s.iframeOrigin){var t=o.clientId+" "+(o.sessionId?o.sessionId:"");s.callbackList.push(e);var r=s.iframeOrigin;1==s.callbackList.length&&s.iframe.contentWindow.postMessage(t,r)}else e.setSuccess();return e.promise}function T(){let e=F();var t,r,n,i,a=y();if(s.enable||o.silentCheckSsoRedirectUri){var c=document.createElement("iframe");c.setAttribute("src",o.endpoints.thirdPartyCookiesIframe()),c.setAttribute("sandbox",e),c.setAttribute("title","keycloak-3p-check-iframe"),c.style.display="none",document.body.appendChild(c);var u=function(e){if(c.contentWindow===e.source)("supported"===e.data||"unsupported"===e.data)&&("unsupported"===e.data&&(h("[KEYCLOAK] Your browser is blocking access to 3rd-party cookies, this means:\n\n - It is not possible to retrieve tokens without redirecting to the Keycloak server (a.k.a. no support for silent authentication).\n - It is not possible to automatically detect changes to the session status (such as the user logging out in another tab).\n\nFor more information see: https://www.keycloak.org/docs/latest/securing_apps/#_modern_browsers"),s.enable=!1,o.silentCheckSsoFallback&&(o.silentCheckSsoRedirectUri=!1)),document.body.removeChild(c),window.removeEventListener("message",u),a.setSuccess())};window.addEventListener("message",u,!1)}else a.setSuccess();return t=a.promise,r=o.messageReceiveTimeout,n=null,i=new f.Promise(function(e,t){n=setTimeout(function(){t({error:"Timeout when waiting for 3rd party check iframe message."})},r)}),f.Promise.race([t,i]).finally(function(){clearTimeout(n)})}function U(e){if(!e||"default"==e)return{login:function(e){return window.location.assign(o.createLoginUrl(e)),y().promise},logout:async function(e){let t=e?.logoutMethod??o.logoutMethod;if("GET"===t){window.location.replace(o.createLogoutUrl(e));return}let n=o.createLogoutUrl(e),i=await fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({id_token_hint:o.idToken,client_id:o.clientId,post_logout_redirect_uri:r.redirectUri(e,!1)})});if(i.redirected){!function e(t){try{let r=new URL(t,window.location.origin);return r.origin===window.location.origin}catch(n){return!1}}(i.url)?window.location.assign("/"):window.location.assign(i.url);return}if(i.ok){window.location.reload();return}throw Error("Logout failed, request returned an error code.")},register:function(e){return window.location.assign(o.createRegisterUrl(e)),y().promise},accountManagement:function(){var e=o.createAccountUrl();if(void 0!==e)window.location.href=e;else throw"Not supported by the OIDC server";return y().promise},redirectUri:function(e,t){return e&&e.redirectUri?e.redirectUri:o.redirectUri?o.redirectUri:function e(){let t=location.href,r=new URL(t);if("http:"!==r.protocol&&"https:"!==r.protocol)throw Error("Unsafe redirect URI");return r.href}()}};if("cordova"==e){s.enable=!1;var t=function(e,t,r){return window.cordova&&window.cordova.InAppBrowser?window.cordova.InAppBrowser.open(e,t,r):window.open(e,t,r)},n=function(e){var t,r,n=(t=e)&&t.cordovaOptions?Object.keys(t.cordovaOptions).reduce(function(e,r){return e[r]=t.cordovaOptions[r],e},{}):{};return n.location="no",e&&"none"==e.prompt&&(n.hidden="yes"),Object.keys(r=n).reduce(function(e,t){return e.push(t+"="+r[t]),e},[]).join(",")},i=function(){return o.redirectUri||"http://localhost"};return{login:function(e){var r=y(),s=n(e),a=o.createLoginUrl(e),c=t(a,"_blank",s),u=!1,l=!1,f=function(){l=!0,c.close()};return c.addEventListener("loadstart",function(e){if(0==e.url.indexOf(i())){var t=_(e.url);g(t,r),f(),u=!0}}),c.addEventListener("loaderror",function(e){if(!u){if(0==e.url.indexOf(i())){var t=_(e.url);g(t,r),f(),u=!0}else r.setError(),f()}}),c.addEventListener("exit",function(e){l||r.setError({reason:"closed_by_user"})}),r.promise},logout:function(e){var r,n=y(),s=o.createLogoutUrl(e),a=t(s,"_blank","location=no,hidden=yes,clearcache=yes");return a.addEventListener("loadstart",function(e){0==e.url.indexOf(i())&&a.close()}),a.addEventListener("loaderror",function(e){0==e.url.indexOf(i())||(r=!0),a.close()}),a.addEventListener("exit",function(e){r?n.setError():(o.clearToken(),n.setSuccess())}),n.promise},register:function(e){var r=y(),s=o.createRegisterUrl(),a=n(e),c=t(s,"_blank",a);return c.addEventListener("loadstart",function(e){if(0==e.url.indexOf(i())){c.close();var t=_(e.url);g(t,r)}}),r.promise},accountManagement:function(){var e=o.createAccountUrl();if(void 0!==e){var r=t(e,"_blank","location=no");r.addEventListener("loadstart",function(e){0==e.url.indexOf(i())&&r.close()})}else throw"Not supported by the OIDC server"},redirectUri:function(e){return i()}}}if("cordova-native"==e)return s.enable=!1,{login:function(e){var t=y(),r=o.createLoginUrl(e);return universalLinks.subscribe("keycloak",function(e){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close();var r=_(e.url);g(r,t)}),window.cordova.plugins.browsertab.openUrl(r),t.promise},logout:function(e){var t=y(),r=o.createLogoutUrl(e);return universalLinks.subscribe("keycloak",function(e){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close(),o.clearToken(),t.setSuccess()}),window.cordova.plugins.browsertab.openUrl(r),t.promise},register:function(e){var t=y(),r=o.createRegisterUrl(e);return universalLinks.subscribe("keycloak",function(e){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close();var r=_(e.url);g(r,t)}),window.cordova.plugins.browsertab.openUrl(r),t.promise},accountManagement:function(){var e=o.createAccountUrl();if(void 0!==e)window.cordova.plugins.browsertab.openUrl(e);else throw"Not supported by the OIDC server"},redirectUri:function(e){return e&&e.redirectUri?e.redirectUri:o.redirectUri?o.redirectUri:"http://localhost"}};throw"invalid adapter type: "+e}o.init=function(e){if(o.didInitialize)throw Error("A 'Keycloak' instance can only be initialized once.");if(o.didInitialize=!0,o.authenticated=!1,n=function e(){try{return new E}catch(t){}return new I}(),r=e&&["default","cordova","cordova-native"].indexOf(e.adapter)>-1?U(e.adapter):e&&"object"==typeof e.adapter?e.adapter:window.Cordova||window.cordova?U("cordova"):U(),e){if(void 0!==e.useNonce&&(u=e.useNonce),void 0!==e.checkLoginIframe&&(s.enable=e.checkLoginIframe),e.checkLoginIframeInterval&&(s.interval=e.checkLoginIframeInterval),"login-required"===e.onLoad&&(o.loginRequired=!0),e.responseMode){if("query"===e.responseMode||"fragment"===e.responseMode)o.responseMode=e.responseMode;else throw"Invalid value for responseMode"}if(e.flow){switch(e.flow){case"standard":o.responseType="code";break;case"implicit":o.responseType="id_token token";break;case"hybrid":o.responseType="code id_token token";break;default:throw"Invalid value for flow"}o.flow=e.flow}if(null!=e.timeSkew&&(o.timeSkew=e.timeSkew),e.redirectUri&&(o.redirectUri=e.redirectUri),e.silentCheckSsoRedirectUri&&(o.silentCheckSsoRedirectUri=e.silentCheckSsoRedirectUri),"boolean"==typeof e.silentCheckSsoFallback?o.silentCheckSsoFallback=e.silentCheckSsoFallback:o.silentCheckSsoFallback=!0,e.pkceMethod){if("S256"!==e.pkceMethod)throw TypeError(`Invalid value for 'pkceMethod', expected 'S256' but got '${e.pkceMethod}'.`);o.pkceMethod=e.pkceMethod}else o.pkceMethod="S256";"boolean"==typeof e.enableLogging?o.enableLogging=e.enableLogging:o.enableLogging=!1,"POST"===e.logoutMethod?o.logoutMethod="POST":o.logoutMethod="GET","string"==typeof e.scope&&(o.scope=e.scope),"string"==typeof e.acrValues&&(o.acrValues=e.acrValues),"number"==typeof e.messageReceiveTimeout&&e.messageReceiveTimeout>0?o.messageReceiveTimeout=e.messageReceiveTimeout:o.messageReceiveTimeout=1e4}o.responseMode||(o.responseMode="fragment"),o.responseType||(o.responseType="code",o.flow="standard");var i=y(),a=y();a.promise.then(function(){o.onReady&&o.onReady(o.authenticated),i.setSuccess(o.authenticated)}).catch(function(e){i.setError(e)});var c=function e(r){var n=y();function i(e){e?o.endpoints={authorize:function(){return e.authorization_endpoint},token:function(){return e.token_endpoint},logout:function(){if(!e.end_session_endpoint)throw"Not supported by the OIDC server";return e.end_session_endpoint},checkSessionIframe:function(){if(!e.check_session_iframe)throw"Not supported by the OIDC server";return e.check_session_iframe},register:function(){throw'Redirection to "Register user" page not supported in standard OIDC mode'},userinfo:function(){if(!e.userinfo_endpoint)throw"Not supported by the OIDC server";return e.userinfo_endpoint}}:o.endpoints={authorize:function(){return v()+"/protocol/openid-connect/auth"},token:function(){return v()+"/protocol/openid-connect/token"},logout:function(){return v()+"/protocol/openid-connect/logout"},checkSessionIframe:function(){var e=v()+"/protocol/openid-connect/login-status-iframe.html";return o.iframeVersion&&(e=e+"?version="+o.iframeVersion),e},thirdPartyCookiesIframe:function(){var e=v()+"/protocol/openid-connect/3p-cookies/step1.html";return o.iframeVersion&&(e=e+"?version="+o.iframeVersion),e},register:function(){return v()+"/protocol/openid-connect/registrations"},userinfo:function(){return v()+"/protocol/openid-connect/userinfo"}}}if(t?"string"==typeof t&&(c=t):c="keycloak.json",c){var s=new XMLHttpRequest;s.open("GET",c,!0),s.setRequestHeader("Accept","application/json"),s.onreadystatechange=function(){if(4==s.readyState){if(200==s.status||x(s)){var e=JSON.parse(s.responseText);o.authServerUrl=e["auth-server-url"],o.realm=e.realm,o.clientId=e.resource,i(null),n.setSuccess()}else n.setError()}},s.send()}else{if(!t.clientId)throw"clientId missing";o.clientId=t.clientId;var a=t.oidcProvider;if(a){if("string"==typeof a){u="/"==a.charAt(a.length-1)?a+".well-known/openid-configuration":a+"/.well-known/openid-configuration";var c,u,s=new XMLHttpRequest;s.open("GET",u,!0),s.setRequestHeader("Accept","application/json"),s.onreadystatechange=function(){4==s.readyState&&(200==s.status||x(s)?(i(JSON.parse(s.responseText)),n.setSuccess()):n.setError())},s.send()}else i(a),n.setSuccess()}else{if(!t.url){for(var l=document.getElementsByTagName("script"),f=0;f<l.length;f++)if(l[f].src.match(/.*keycloak\.js/)){t.url=l[f].src.substr(0,l[f].src.indexOf("/js/keycloak.js"));break}}if(!t.realm)throw"realm missing";o.authServerUrl=t.url,o.realm=t.realm,i(null),n.setSuccess()}}return n.promise}();let l=F();function f(){var t=function(t){t||(n.prompt="none"),e&&e.locale&&(n.locale=e.locale),o.login(n).then(function(){a.setSuccess()}).catch(function(e){a.setError(e)})},r=function(){var e=document.createElement("iframe"),t=o.createLoginUrl({prompt:"none",redirectUri:o.silentCheckSsoRedirectUri});e.setAttribute("src",t),e.setAttribute("sandbox",l),e.setAttribute("title","keycloak-silent-check-sso"),e.style.display="none",document.body.appendChild(e);var r=function(t){if(t.origin===window.location.origin&&e.contentWindow===t.source){var n=_(t.data);g(n,a),document.body.removeChild(e),window.removeEventListener("message",r)}};window.addEventListener("message",r)},n={};switch(e.onLoad){case"check-sso":s.enable?w().then(function(){A().then(function(e){e?a.setSuccess():o.silentCheckSsoRedirectUri?r():t(!1)}).catch(function(e){a.setError(e)})}):o.silentCheckSsoRedirectUri?r():t(!1);break;case"login-required":t(!0);break;default:throw"Invalid value for onLoad"}}function h(){var t=_(window.location.href);if(t&&window.history.replaceState(window.history.state,null,t.newUrl),t&&t.valid)return w().then(function(){g(t,a)}).catch(function(e){a.setError(e)});e?e.token&&e.refreshToken?(m(e.token,e.refreshToken,e.idToken),s.enable?w().then(function(){A().then(function(e){e?(o.onAuthSuccess&&o.onAuthSuccess(),a.setSuccess(),S()):a.setSuccess()}).catch(function(e){a.setError(e)})}):o.updateToken(-1).then(function(){o.onAuthSuccess&&o.onAuthSuccess(),a.setSuccess()}).catch(function(t){o.onAuthError&&o.onAuthError(),e.onLoad?f():a.setError(t)})):e.onLoad?f():a.setSuccess():a.setSuccess()}return c.then(function(){var e,t;(e=y(),t=function(){("interactive"===document.readyState||"complete"===document.readyState)&&(document.removeEventListener("readystatechange",t),e.setSuccess())},document.addEventListener("readystatechange",t),t(),e.promise).then(T).then(h).catch(function(e){i.setError(e)})}),c.catch(function(e){i.setError(e)}),i.promise},o.login=function(e){return r.login(e)},o.createLoginUrl=function(e){var t,i,s=k(),a=k(),c=r.redirectUri(e),l={state:s,nonce:a,redirectUri:encodeURIComponent(c)};e&&e.prompt&&(l.prompt=e.prompt),i=e&&"register"==e.action?o.endpoints.register():o.endpoints.authorize();var f=e&&e.scope||o.scope;f?-1===f.indexOf("openid")&&(f="openid "+f):f="openid";var h=i+"?client_id="+encodeURIComponent(o.clientId)+"&redirect_uri="+encodeURIComponent(c)+"&state="+encodeURIComponent(s)+"&response_mode="+encodeURIComponent(o.responseMode)+"&response_type="+encodeURIComponent(o.responseType)+"&scope="+encodeURIComponent(f);if(u&&(h=h+"&nonce="+encodeURIComponent(a)),e&&e.prompt&&(h+="&prompt="+encodeURIComponent(e.prompt)),e&&e.maxAge&&(h+="&max_age="+encodeURIComponent(e.maxAge)),e&&e.loginHint&&(h+="&login_hint="+encodeURIComponent(e.loginHint)),e&&e.idpHint&&(h+="&kc_idp_hint="+encodeURIComponent(e.idpHint)),e&&e.action&&"register"!=e.action&&(h+="&kc_action="+encodeURIComponent(e.action)),e&&e.locale&&(h+="&ui_locales="+encodeURIComponent(e.locale)),e&&e.acr&&(h+="&claims="+encodeURIComponent(JSON.stringify({id_token:{acr:t=e.acr}}))),(e&&e.acrValues||o.acrValues)&&(h+="&acr_values="+encodeURIComponent(e.acrValues||o.acrValues)),o.pkceMethod){var p=d(96,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789");l.pkceCodeVerifier=p;var v=function e(t,r){if("S256"!==t)throw TypeError(`Invalid value for 'pkceMethod', expected 'S256' but got '${t}'.`);let n=new Uint8Array($.arrayBuffer(r)),o=(function e(t){let r=String.fromCodePoint(...t);return btoa(r)})(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"");return o}(o.pkceMethod,p);h+="&code_challenge="+v,h+="&code_challenge_method="+o.pkceMethod}return n.add(l),h},o.logout=function(e){return r.logout(e)},o.createLogoutUrl=function(e){let t=e?.logoutMethod??o.logoutMethod;if("POST"===t)return o.endpoints.logout();var n=o.endpoints.logout()+"?client_id="+encodeURIComponent(o.clientId)+"&post_logout_redirect_uri="+encodeURIComponent(r.redirectUri(e,!1));return o.idToken&&(n+="&id_token_hint="+encodeURIComponent(o.idToken)),n},o.register=function(e){return r.register(e)},o.createRegisterUrl=function(e){return e||(e={}),e.action="register",o.createLoginUrl(e)},o.createAccountUrl=function(e){var t=v(),n=void 0;return void 0!==t&&(n=t+"/account?referrer="+encodeURIComponent(o.clientId)+"&referrer_uri="+encodeURIComponent(r.redirectUri(e))),n},o.accountManagement=function(){return r.accountManagement()},o.hasRealmRole=function(e){var t=o.realmAccess;return!!t&&t.roles.indexOf(e)>=0},o.hasResourceRole=function(e,t){if(!o.resourceAccess)return!1;var r=o.resourceAccess[t||o.clientId];return!!r&&r.roles.indexOf(e)>=0},o.loadUserProfile=function(){var e=v()+"/account",t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Authorization","bearer "+o.token);var r=y();return t.onreadystatechange=function(){4==t.readyState&&(200==t.status?(o.profile=JSON.parse(t.responseText),r.setSuccess(o.profile)):r.setError())},t.send(),r.promise},o.loadUserInfo=function(){var e=o.endpoints.userinfo(),t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Authorization","bearer "+o.token);var r=y();return t.onreadystatechange=function(){4==t.readyState&&(200==t.status?(o.userInfo=JSON.parse(t.responseText),r.setSuccess(o.userInfo)):r.setError())},t.send(),r.promise},o.isTokenExpired=function(e){if(!o.tokenParsed||!o.refreshToken&&"implicit"!=o.flow)throw"Not authenticated";if(null==o.timeSkew)return l("[KEYCLOAK] Unable to determine if token is expired as timeskew is not set"),!0;var t=o.tokenParsed.exp-Math.ceil(new Date().getTime()/1e3)+o.timeSkew;if(e){if(isNaN(e))throw"Invalid minValidity";t-=e}return t<0},o.updateToken=function(e){var t=y();if(!o.refreshToken)return t.setError(),t.promise;e=e||5;var r=function(){var r=!1;if(-1==e?(r=!0,l("[KEYCLOAK] Refreshing token: forced refresh")):(!o.tokenParsed||o.isTokenExpired(e))&&(r=!0,l("[KEYCLOAK] Refreshing token: token expired")),r){var n="grant_type=refresh_token&refresh_token="+o.refreshToken,s=o.endpoints.token();if(i.push(t),1==i.length){var a=new XMLHttpRequest;a.open("POST",s,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.withCredentials=!0,n+="&client_id="+encodeURIComponent(o.clientId);var c=new Date().getTime();a.onreadystatechange=function(){if(4==a.readyState){if(200==a.status){l("[KEYCLOAK] Token refreshed"),c=(c+new Date().getTime())/2;var e=JSON.parse(a.responseText);m(e.access_token,e.refresh_token,e.id_token,c),o.onAuthRefreshSuccess&&o.onAuthRefreshSuccess();for(var t=i.pop();null!=t;t=i.pop())t.setSuccess(!0)}else{h("[KEYCLOAK] Failed to refresh token"),400==a.status&&o.clearToken(),o.onAuthRefreshError&&o.onAuthRefreshError();for(var t=i.pop();null!=t;t=i.pop())t.setError(!0)}}},a.send(n)}}else t.setSuccess(!1)};return s.enable?A().then(function(){r()}).catch(function(e){t.setError(e)}):r(),t.promise},o.clearToken=function(){o.token&&(m(null,null,null),o.onAuthLogout&&o.onAuthLogout(),o.loginRequired&&o.login())};var E=function(){if(!(this instanceof E))return new E;localStorage.setItem("kc-test","test"),localStorage.removeItem("kc-test");var e=this;function t(){for(var e=new Date().getTime(),t=0;t<localStorage.length;t++){var r=localStorage.key(t);if(r&&0==r.indexOf("kc-callback-")){var n=localStorage.getItem(r);if(n)try{var o=JSON.parse(n).expires;(!o||o<e)&&localStorage.removeItem(r)}catch(i){localStorage.removeItem(r)}}}}e.get=function(e){if(e){var r="kc-callback-"+e,n=localStorage.getItem(r);return n&&(localStorage.removeItem(r),n=JSON.parse(n)),t(),n}},e.add=function(e){t();var r="kc-callback-"+e.state;e.expires=new Date().getTime()+36e5,localStorage.setItem(r,JSON.stringify(e))}},I=function(){if(!(this instanceof I))return new I;var e=this;e.get=function(e){if(e){var o=r("kc-callback-"+e);if(n("kc-callback-"+e,"",t(-100)),o)return JSON.parse(o)}},e.add=function(e){n("kc-callback-"+e.state,JSON.stringify(e),t(60))},e.removeItem=function(e){n(e,"",t(-100))};var t=function(e){var t=new Date;return t.setTime(t.getTime()+6e4*e),t},r=function(e){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var o=r[n];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""},n=function(e,t,r){var n=e+"="+t+"; expires="+r.toUTCString()+"; ";document.cookie=n}};function C(e){return function(){o.enableLogging&&e.apply(console,Array.prototype.slice.call(arguments))}}}});